# Release Process

This document describes the automated release process for Moonriver.

## Overview

When you push a version tag (e.g., `v0.1.0`), the GitHub Actions workflow automatically:

1. Creates a GitHub release with a changelog generated by git-cliff
2. Builds binaries for multiple platforms (Linux, macOS, Windows)
3. Creates Debian packages for amd64 and arm64
4. Uploads all artifacts to the release

## Creating a Release

### 1. Update Version

Update the version in `Cargo.toml`:

```toml
[package]
version = "0.2.0"
```

### 2. Commit Changes

```bash
git add Cargo.toml
git commit -m "chore(release): prepare for v0.2.0"
```

### 3. Create and Push Tag

```bash
git tag -a v0.2.0 -m "Release v0.2.0"
git push origin main
git push origin v0.2.0
```

### 4. Wait for Actions

The release workflow will automatically:
- Generate a changelog from your git commit history
- Build binaries for all supported platforms
- Create Debian packages
- Upload everything to GitHub Releases

### 5. Update Homebrew Formula (if in homebrew-core)

After the release is published, update the Homebrew formula:

```bash
# Use the helper script
./scripts/update_formula.sh 0.2.0

# Or manually update moonriver.rb with new version and SHA256
```

Then submit a PR to homebrew-core (see HOMEBREW.md for details).

## Commit Message Format

For the best changelog generation, use [Conventional Commits](https://www.conventionalcommits.org/):

- `feat: add new feature` - New features
- `fix: resolve bug` - Bug fixes
- `docs: update documentation` - Documentation changes
- `perf: improve performance` - Performance improvements
- `refactor: restructure code` - Code refactoring
- `style: format code` - Code styling
- `test: add tests` - Testing
- `chore: update dependencies` - Miscellaneous tasks

Example:
```bash
git commit -m "feat: add support for multiple printers"
git commit -m "fix: handle WebSocket disconnections gracefully"
git commit -m "docs: update installation instructions"
```

## Installing Released Binaries

### Using Homebrew (macOS)

```bash
brew install moonriver
```

### Using cargo-binstall (Recommended for other platforms)

```bash
cargo binstall moonriver
```

This will automatically download the appropriate binary for your platform from GitHub Releases.

### Using Debian Package

For Debian/Ubuntu systems:

```bash
# Download the appropriate .deb file
wget https://github.com/willpuckett/moonriver/releases/download/v0.2.0/moonriver_0.2.0_amd64.deb

# Install it
sudo dpkg -i moonriver_0.2.0_amd64.deb
```

### Manual Installation

1. Go to the [Releases page](https://github.com/willpuckett/moonriver/releases)
2. Download the appropriate archive for your platform
3. Extract and move the binary to your PATH

Example for Linux:
```bash
tar xzf moonriver-x86_64-unknown-linux-gnu.tar.gz
sudo mv moonriver /usr/local/bin/
```

## Available Platforms

The release workflow builds binaries for:

- **Linux**: x86_64 (glibc and musl), aarch64
- **macOS**: x86_64 (Intel), aarch64 (Apple Silicon)
- **Windows**: x86_64

Debian packages are available for:
- amd64 (x86_64)
- arm64 (aarch64)

## Troubleshooting

### Release Workflow Fails

Check the GitHub Actions logs to see which step failed. Common issues:

1. **Build failure**: Ensure the code compiles on all platforms
2. **Tag format**: Use `v` prefix (e.g., `v0.2.0`, not `0.2.0`)
3. **Permissions**: Ensure the workflow has write permissions for releases

### cargo-binstall Can't Find Release

Ensure:
1. The release exists on GitHub
2. The binary naming follows the pattern: `moonriver-{target}.tar.gz`
3. The release is published (not a draft)

## Configuration Files

- `.github/workflows/release.yml` - GitHub Actions workflow
- `cliff.toml` - git-cliff configuration for changelog generation
- `Cargo.toml` - Contains Debian package metadata under `[package.metadata.deb]`
